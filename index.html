<!DOCTYPE html>
<html>
<head>
  <script
    src="https://code.jquery.com/jquery-3.6.1.min.js"
    integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
    crossorigin="anonymous"></script>
  <script language="javascript" type="text/javascript">
    $( document ).ready(function() {

      $("tbody tr[evindex='0']").each(function(index) { /* add class c1/c2 even/odd rows */
        if (index % 2 === 0) { 
          $(this).attr('class', 'c1'); /* father */
          pgroup = $(this).attr('group');  /*  children process group identifier */
          $("tr[group='" + pgroup + "']:not([evindex='0'])").attr('class', 'c1');
        }
        else { 
          $(this).attr('class', 'c2'); /* father */
          pgroup = $(this).attr('group');  /*  children process group identifier */
          $("tr[group='" + pgroup + "']:not([evindex='0'])").attr('class', 'c2');
        }
      }); 

      $("tr[evindex='0']:not([evn='1'])").click(function(event) {
        if( event.target.tagName != 'INPUT' ){ /* to avoid colapse on click on checkbox */
          $("body").css("cursor", "progress"); /* wait cursor */
          //open up the events - toggle from the process atribute 
          pgroup = $(this).attr('group');  
          events = $("tr[group='" + pgroup + "']:not([evindex='0'])")                    
          nenv = events.length;
          events.each(function(index, event){         
            /* toogle slide up/down for all event rows except last */
            if(index < nenv-1)
              $(event).slideToggle();             
          });
          /* triggers POST to save on last one on json table */          
          events.last().slideToggle(function(){
            var data = {};
            data['process'] = pgroup;
            data['style'] = $(this).css('display'); 
            fetch("/update", {
              method: "POST",
              headers: {'Content-Type': 'application/json'}, 
              body: JSON.stringify(data)
            }).then(function(response) {
              $("body").css("cursor", "default"); /* default cursor */
            });     
          }); 
        }        
      });
      $("input[type='checkbox']").click(function(event) {
        $("body").css("cursor", "progress"); /* wait cursor */
        var data = {};        
        parent = event.target.parentElement.parentElement.getAttribute('group');          
        data['process'] = parent;
        data['state'] = event.target.checked;        
        fetch("/update", {
          method: "POST",
          headers: {'Content-Type': 'application/json'}, 
          body: JSON.stringify(data)
        }).then(function(response) {
          $("body").css("cursor", "default"); /* default cursor */
        });        
      });

      document.title = "{{ processo }}"; /* set window name to easy work */

    });
  </script>
  <style>
    html {
      font-size: 14px; 
      font-family: Verdana, Geneva, Tahoma, sans-serif;
      background-color: rgb(241, 248, 248);
    }
    table {      
      width: 100%;
      border: 1px solid #CCC;
      border-collapse: collapse;
    }
    th {
      font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
      font-size: 16px;
      border: none;      
    }
    td { /* default settings */   
      border: none;
      text-align: center;      
      max-width: fit-content;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    tr[evindex='0']:not([evn='1']) { /* has events - mark bold */
      font-weight: bold;
    } 
    tbody tr[ativo='não'] { /* mark dead processes */
      color: rgb(148, 13, 40);      
    }
    tbody tr[ativo='sim'] { /* mark dead processes */
      color: blue;      
    }
    /* Descrição (6) must be readable completely */
    tr td:nth-child(6) { max-width: fit-content !important; }
    /* OBS(7) DOU(8) set max-width with rem - 
    don't need to read at first glance */
    tr td:nth-child(11), tr td:nth-child(12) {
      max-width: 15rem !important;
    } 
    /* to read overflow hidden text on 11, 12 */
    tr td:nth-child(11):hover, tr td:nth-child(12):hover { /* disable overflow on hover */
      /* show content as a box */
      overflow: visible;
      white-space: normal;
      position: fixed;
      background-color: white;
      box-shadow: 0 0 4px 0 black;
    }
    tr.c1 { background-color: white;   }
    tr.c2 { background-color: #78b0de;   }
    tr:hover { background-color: rgb(180, 180, 180) !important; }
  </style>
</head> 
<body>
  {% if processos_list %}
    <h2>Pick a process</h2>
    <ol>
    {% for process in processos_list %}  
      <li><a href="/select?selected={{ process.replace('/','-') }}">{{ process }}</a></li>
      {% endfor %}
    </ol>
  {% else %}    
    <p style="text-align:center;font-size: medium;font-weight: bold;display: block;">Prioridade {{ processo }}  </p  >  
    {{ pandas_table|safe }}     
  {% endif %}    
</body>
</html>





   
